# Исправление: Автоматизация входа в систему

## Проблема
Пользователь сообщил: "пишет 'Неверный логин или пароль'"

## Причина
Администратор существовал в БД, но пароль был неизвестен/забыт.

## Решение

### 1. Создан скрипт автоматической настройки администратора

**Файл:** `backend/setup_admin.py`

Скрипт автоматически:
- Создает администратора `admin` если его нет
- Обновляет пароль на `admin123` если пользователь уже существует
- Гарантирует права суперпользователя

### 2. Интеграция в VS Code Tasks

**Файл:** `.vscode/tasks.json`

Добавлена задача `Setup Admin User` которая:
- Запускается автоматически перед стартом Backend
- Выполняется при каждом открытии проекта
- Гарантирует наличие администратора с известными учетными данными

### 3. Интеграция в PowerShell скрипты

**Файл:** `start_servers.ps1`

Обновлен для:
- Автоматического запуска setup_admin.py перед backend
- Вывода учетных данных после запуска

### 4. Документация

Созданы/обновлены файлы:
- **CREDENTIALS.md** - полная информация об учетных данных
- **README.md** - добавлены учетные данные в быстрый старт
- **CHEATSHEET.md** - добавлен раздел о проблемах с паролем

## Учетные данные по умолчанию

```
Логин:  admin
Пароль: admin123
```

## Автоматизация

### При открытии VS Code:
1. Запускается `Setup Admin User` task
2. Создается/обновляется администратор
3. Запускается Backend с готовым пользователем
4. Пользователь может сразу войти

### При ручном запуске через start_servers.ps1:
1. Выполняется setup_admin.py
2. Выводятся учетные данные
3. Пользователь знает логин/пароль

### Ручной сброс (если нужно):
```bash
cd backend
D:\B2B\PDM\.venv\Scripts\python.exe setup_admin.py
```

## Проверка работы

### Тест входа через API:
```powershell
$body = @{username='admin'; password='admin123'} | ConvertTo-Json
Invoke-WebRequest -Uri 'http://localhost:8000/api/v1/auth/login/' `
  -Method POST -Body $body -ContentType 'application/json'
```

**Результат:**
```
Status: 200 OK
Токены получены успешно
```

### Тест через браузер:
1. Открыть http://localhost:3000
2. Ввести:
   - Логин: `admin`
   - Пароль: `admin123`
3. Успешный вход ✅

## Безопасность

⚠️ **Важно для production:**

1. Измените пароль администратора после первого входа
2. Создайте отдельных пользователей для работы
3. Не используйте admin для повседневной работы
4. Рассмотрите возможность отключения `setup_admin.py` в production

### Как изменить пароль:

```bash
cd backend
python manage.py shell
```

```python
from django.contrib.auth import get_user_model
User = get_user_model()
user = User.objects.get(username='admin')
user.set_password('новый_сложный_пароль')
user.save()
```

## Преимущества решения

### До:
- ❌ Неизвестный пароль администратора
- ❌ Невозможность входа
- ❌ Нужно вручную создавать пользователя
- ❌ Забытые учетные данные

### После:
- ✅ Автоматическое создание администратора
- ✅ Известные учетные данные
- ✅ Документированный процесс
- ✅ Работает "из коробки"
- ✅ Автоматический сброс при необходимости

## Workflow пользователя

### Первое использование:
1. Открыть VS Code
2. Открыть http://localhost:3000
3. Войти: admin / admin123
4. Начать работу ✅

### После перезапуска:
1. Открыть VS Code
2. Администратор автоматически проверен/создан
3. Войти: admin / admin123
4. Продолжить работу ✅

### Забыли пароль:
1. Выполнить: `python setup_admin.py`
2. Пароль сброшен на admin123
3. Войти снова ✅

## Файлы изменены

- ✅ `backend/setup_admin.py` - создан
- ✅ `.vscode/tasks.json` - добавлена задача Setup Admin User
- ✅ `start_servers.ps1` - добавлен вызов setup_admin.py
- ✅ `CREDENTIALS.md` - создан
- ✅ `README.md` - добавлены учетные данные
- ✅ `CHEATSHEET.md` - добавлен раздел о проблемах с паролем

## Тестирование

✅ Проверено:
- Создание нового администратора
- Обновление существующего администратора
- Вход через API
- Получение токенов
- Автоматический запуск через VS Code tasks
- Ручной запуск через PowerShell

**Статус:** Работает корректно ✅

---

**Дата:** 13 января 2026  
**Проблема:** Неверный логин или пароль  
**Решение:** Автоматическое создание/обновление администратора  
**Результат:** Система работает автоматически без ручного вмешательства
